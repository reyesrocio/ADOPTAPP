<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Admin | GestiÃ³n de Mascotas</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
<style>
body { font-family:'Poppins', sans-serif; background:#f4f6fa; padding:20px; }
h1 { text-align:center; color:#4a6fa5; }
input, select, textarea, button { width:100%; padding:10px; margin:5px 0; }
.card { background:white; padding:15px; margin:10px 0; border-radius:10px; box-shadow:0 5px 15px rgba(0,0,0,.1); }
.card img { width:150px; margin-top:5px; border-radius:5px; }
.btn { padding:8px; margin:5px; border:none; cursor:pointer; border-radius:5px; }
.btn-edit { background:#2196F3; color:white; }
.btn-delete { background:#f44336; color:white; }
.btn-save { background:#4CAF50; color:white; }
.btn-adoptado { background:#8a2be2; color:white; }
h2 { color:#4a6fa5; margin-top:30px; }
</style>
</head>
<body>

<script>
if(localStorage.getItem("adminLogueado") !== "true") {
    window.location.href="admin.html";
}
</script>

<h1>ğŸ¾ GestiÃ³n de Mascotas</h1>

<div class="card">
  <h3>Agregar / Editar Mascota</h3>
  <input id="nombre" placeholder="Nombre">
  <select id="tipo">
    <option value="">Tipo</option>
    <option>Perro</option>
    <option>Gato</option>
  </select>
  <input id="raza" placeholder="Raza">
  <input id="edad" type="number" placeholder="Edad">
  <select id="sexo">
    <option value="">Sexo</option>
    <option>Macho</option>
    <option>Hembra</option>
  </select>
  <textarea id="descripcion" placeholder="DescripciÃ³n"></textarea>
  <input id="imagen" placeholder="URL de imagen">
  <button class="btn btn-save" onclick="guardar()">ğŸ’¾ Guardar</button>
</div>

<h2>ğŸ“‹ Mascotas Registradas</h2>
<div id="lista"></div>

<h2>ğŸ“¬ Solicitudes de AdopciÃ³n</h2>
<div id="solicitudes"></div>

<script>
let mascotas = JSON.parse(localStorage.getItem("mascotasDB")) || [];
let solicitudes = JSON.parse(localStorage.getItem("solicitudesDB")) || [];
let editId = null;

function render() {
    const lista = document.getElementById("lista");
    lista.innerHTML = "";
    mascotas.forEach(m => {
        lista.innerHTML += `
        <div class="card">
            <b>${m.nombre}</b> (${m.tipo})<br>
            ${m.raza} â€¢ ${m.edad} aÃ±os â€¢ ${m.sexo}<br>
            <small>${m.descripcion}</small><br>
            ${m.imagen ? `<img src="${m.imagen}" alt="${m.nombre}">` : ""}
            <p>Estado: ${m.disponible ? 'Analizando' : 'Adoptado'}</p>
            <button class="btn btn-edit" onclick="editar(${m.id})">âœï¸ Editar</button>
            <button class="btn btn-delete" onclick="eliminar(${m.id})">ğŸ—‘ï¸ Eliminar</button>
            ${m.disponible ? `<button class="btn btn-adoptado" onclick="marcarAdoptado(${m.id})">Marcar como Adoptado</button>` : ''}
        </div>
        `;
    });

    const cont = document.getElementById("solicitudes");
    cont.innerHTML = "";
    solicitudes.forEach(s => {
        const mascota = mascotas.find(m => m.id == s.mascotaId);
        if(mascota){
            cont.innerHTML += `
            <div class="card">
                <b>${s.nombre}</b> solicitando a <b>${mascota.nombre}</b><br>
                DNI: ${s.dni} | Tel: ${s.telefono} | Correo: ${s.correo} <br>
                Fecha: ${s.fecha}
            </div>
            `;
        }
    });
}

function guardar(){
    if(!nombre.value || !tipo.value || !edad.value){
        alert("Por favor completa Nombre, Tipo y Edad"); return;
    }
    const mascota = {
        id: editId || Date.now(),
        nombre: nombre.value,
        tipo: tipo.value,
        raza: raza.value,
        edad: edad.value,
        sexo: sexo.value,
        descripcion: descripcion.value,
        imagen: imagen.value,
        disponible: true
    };
    if(editId){
        const i = mascotas.findIndex(m=>m.id===editId);
        mascotas[i] = mascota;
        editId=null;
    } else {
        mascotas.push(mascota);
    }
    localStorage.setItem("mascotasDB", JSON.stringify(mascotas));
    limpiar(); render();
}

function editar(id){
    const m = mascotas.find(x=>x.id===id);
    editId = id;
    nombre.value = m.nombre;
    tipo.value = m.tipo;
    raza.value = m.raza;
    edad.value = m.edad;
    sexo.value = m.sexo;
    descripcion.value = m.descripcion;
    imagen.value = m.imagen;
}

function eliminar(id){
    if(!confirm("Â¿Eliminar esta mascota?")) return;
    mascotas = mascotas.filter(m=>m.id!==id);
    localStorage.setItem("mascotasDB", JSON.stringify(mascotas));
    render();
}

function limpiar(){
    nombre.value=""; tipo.value=""; raza.value="";
    edad.value=""; sexo.value=""; descripcion.value=""; imagen.value="";
}

function marcarAdoptado(id){
    const m = mascotas.find(x=>x.id===id);
    if(m) { m.disponible=false; localStorage.setItem("mascotasDB", JSON.stringify(mascotas)); render(); }
}

render();
</script>

</body>
</html>
